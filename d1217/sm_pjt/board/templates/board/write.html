{% extends "base.html" %}




{% block title-block %}
<title>VLAST Shop - 게시판글쓰기</title>

{% endblock title-block %}

{% block css-block %}
<!-- 개별영역 : css -->
<link rel='stylesheet' href='/static/css/write.css'>
{% endblock css-block %}

  
{% block body-block %}
  <!-- 개별영역 : 글쓰기 폼 -->
  <script>
    if('{{flag}}'=='1'){
        alert('게시글이 등록되었습니다.');
        location.href='/board/list/';
      }
  </script>
  <div class="write-container">
    <div class="write-title">게시글 작성</div>
    <form class="write-form" id="writeForm" name='frm' action='/board/write/' method='post' enctype='multipart/form-data'>
      {% csrf_token %}
      <input type="text" name='id' id="writer" value='{{request.session.session_name}}' disabled />
      <input type="text" name='btitle' id="title" placeholder="제목" maxlength="100" required />
      <textarea id='summernote' name='bcontent' placeholder="내용을 입력하세요." maxlength="2000" required></textarea>
      
      <input type="file" name='bfile' onchange='readURL(this);'  />
      <img id='preview' style='width:100px'>
      
      <div class="write-buttons">
        <button type="submit">등록</button>
        <button type="button" class="cancel" onclick="history.back()">취소</button>
      </div>
    </form>
  </div>

<!-- include libraries(jQuery, bootstrap) -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<!-- include summernote css/js -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>

  <script>

  $(document).ready(function() {
    //여기 아래 부분
    $('#summernote').summernote({
      height: 300,                 // 에디터 높이
		  minHeight: 200,           // 에디터 최소 높이
		  maxHeight: 400,          // 에디터 최대 높이
		  focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
		  lang: "ko-KR",	         // 한글 설정
		  placeholder: '최대 2048자까지 쓸 수 있습니다' , 	//placeholder 설정
      //  추가 부분
                                   toolbar: [
			    // [groupName, [list of button]]
			    ['fontname', ['fontname']],
			    ['fontsize', ['fontsize']],
			    ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
			    ['color', ['forecolor','color']],
			    ['table', ['table']],
			    ['para', ['ul', 'ol', 'paragraph']],
			    ['height', ['height']],
			    ['insert',['picture','link','video']],
			    ['view', ['fullscreen', 'help']]
			  ],
			fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','맑은 고딕','궁서','굴림체','굴림','돋움체','바탕체'],
			fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72'],
      callbacks: { //여기 부분이 이미지를 첨부하는 부분
        onImageUpload : function(files) {
        uploadSummernoteImageFile(files[0],this); //이미지 업로드 호출
        },
        onPaste: function (e) {
          var clipboardData = e.originalEvent.clipboardData;
          if (clipboardData && clipboardData.items &&    
          clipboardData.items.length) {
              var item = clipboardData.items[0];
      if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
        e.preventDefault();
              }
          }
        }
      } //callbacks
    });
  });

  /**
* 이미지 파일 업로드
*/
function uploadSummernoteImageFile (file, this_editor) {
var form_data = new FormData();
      form_data.append('file', file);
      $.ajax({
        data: form_data,
        type: "POST",
        url: '/board/profileUpload/',
        cache: false,
        contentType: false,
        enctype: 'multipart/form-data',
        processData: false,
        success: function(img_name) {
        $(this_editor).summernote('editor.insertImage', img_name);
        }
      });
    }


    // 이미지 업로드시 이미지 미리보기 함수
    function readURL(input){
        // 파일첨부가 있으면
        if(input.files && input.files[0]){
            var reader = new FileReader();
            reader.onload = function(e){
                document.getElementById('preview').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }else{
            // 없을 경우 빈공백 처리
            document.getElementById('preview').src = '';
        }
    }




    const writeForm = document.getElementById('writeForm');

    writeForm.addEventListener('submit', (e) => {
      e.preventDefault(); //무조건 전송하는 것을 방지

      const writer = document.getElementById('writer').value.trim();
      const title = document.getElementById('title').value.trim();
      const summernote = document.getElementById('summernote').value.trim();

      if (!writer || !title || !summernote) {
        alert('모든 항목을 입력해주세요.');
        return;
      }

      frm.submit();

    });
  </script>

  
{% endblock body-block %}
